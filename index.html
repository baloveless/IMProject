<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
      integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
      crossorigin="anonymous"
    />
    <title>IMProject</title>
    <style>
      #login-card {
        height: 150px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <div id="error-container" class="text-center"></div>
  </body>
  <script>
    var host = 'http://localhost:3000';
    var homePage = host+'/login';
    function onError(message) {
      document.getElementById("error-container").innerHTML = message;
    }

    function hasToken() {
      var token = document.cookie.split("=")[1];
      var headers = new Headers();
      console.log(document.cookie);
      headers.append("Authorization", document.cookie);

      fetch("/api/users/current", {
        method: "GET",
        headers: headers,
      })
        .then((response) => response.json()) // make response json
        .then((json) => {
          if (json.errors === undefined)
            document.cookie = `token=${json.user.token}`;
          else onError(json.errors.message);
        });
    }

    function noToken() {
      window.location = homePage;
    }

    if (document.cookie === '') noToken();
    else hasToken();
  </script>
</html>
